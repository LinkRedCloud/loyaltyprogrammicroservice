define(["ojs/ojcore","knockout","jquery","promise","ojs/ojtable","ojs/ojarraydataprovider","ojs/ojarraytabledatasource","ojs/ojpictochart"],function(o,t,e){"use strict";function a(){function a(o){var t=o.customer;t?(r.username(t.title+" "+t.firstName+" "+t.lastName),r.customerIdentifier(t.customerIdentifier)):r.customerIdentifier("CUST0001")}var r=this;r.lPointsMovements=t.observableArray(),e.getJSON("https://loyaltyprogramms-soaringcloudloyaltyms.eucom-north-1.oraclecloud.com/api/v1/").then(function(o){var t=[];e.each(o,function(){t.push({movementId:this.movementId,customerId:this.customerId,orderId:this.orderId,orderNetValue:this.orderNetValue,loyaltyPoints:this.loyaltyPoints,transactionId:this.transactionId,movementDate:new Date(this.movementDate)})}),r.lPointsMovements(t)}),r.datasource=new o.ArrayTableDataSource(r.lPointsMovements,{idAttribute:"movementId"}),r.pointsBalance=t.observable(),r.statusTier=t.observable(),r.username=t.observable(""),r.customerIdentifier=t.observable("");var n=t.dataFor(document.getElementById("globalBody"));a(n.globalContext),e.getJSON("https://loyaltyprogramms-soaringcloudloyaltyms.eucom-north-1.oraclecloud.com/api/v1/status/"+r.customerIdentifier()).then(function(o){r.pointsBalance(o[0].balance),r.statusTier(o[0].status)});var s={};s.SILVER={count:1,color:"#aaaaaa"},s.GOLD={count:2,color:"#ffd700"},s.PLATINUM={count:3,color:"#cccccc"},s.DIAMOND={count:4,color:"#aa0000"},r.pictoChartItems=t.observableArray([{name:"Tier",shape:"star",count:s.GOLD.count,color:s.GOLD.color},{name:"Tier levels",shape:"star",count:4-s.GOLD.count,borderColor:"#aaaaaa",color:"#ffffff"}]),n.registerGlobalContextListener(function(o){console.log("loyalty - global context listener - receiving global context "+JSON.stringify(o)),a(o)})}return new a});